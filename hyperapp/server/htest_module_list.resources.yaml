import:
  - legacy_module.server.htest_module_list
  - legacy_service.mosaic
  - legacy_service.web
  - legacy_service.peer_registry
  - legacy_service.rpc_call_factory
  - legacy_service.server_identity
  - legacy_service.server_rpc_endpoint
  - legacy_type.htest.htest_module_list_d
  - server.htest.htest
  - server.htest.htest_list
  - server.module_list.available_module_list_service

definitions:

  servant_ctr:
    type: attribute
    object: legacy_module.server.htest_module_list
    attr_name: TestModuleListServant

  servant_factory:
    type: partial
    function: servant_ctr
    params:
      mosaic: legacy_service.mosaic
      web: legacy_service.web
      peer_registry: legacy_service.peer_registry
      rpc_call_factory: legacy_service.rpc_call_factory
      identity: legacy_service.server_identity
      rpc_endpoint: legacy_service.server_rpc_endpoint
      htest: server.htest.htest
      htest_list: server.htest.htest_list

  servant:
    type: call
    function: servant_factory

  servant_list_method:
    type: attribute
    object: servant
    attr_name: list

  servant_module_method:
    type: attribute
    object: servant
    attr_name: module

  servant_select_module_method:
    type: attribute
    object: servant
    attr_name: select_module

  servant_set_module_method:
    type: attribute
    object: servant
    attr_name: set_module

  servant_collect_globals_method:
    type: attribute
    object: servant
    attr_name: collect_globals

  set_module_function:
    type: attribute
    object: legacy_module.server.htest_module_list
    attr_name: set_module

  set_module_partial:
    type: partial
    function: set_module_function
    params:
      htest_list: server.htest.htest_list
      service: service

  rpc_callback:
    type: rpc_callback
    identity: legacy_service.server_identity
    function: set_module_partial
    item_attributes: ['module_name', 'module_ref']

  module_selector:
    type: selector
    list_service: server.module_list.available_module_list_service
    callback: rpc_callback

  module_command:
    type: rpc_command
    identity: legacy_service.server_identity
    function: servant_module_method
    state_attributes: ['current_key']
    name: module

  select_module_function:
    type: attribute
    object: legacy_module.server.htest_module_list
    attr_name: select_module

  select_module_partial:
    type: partial
    function: select_module_function
    params:
      module_selector: module_selector

  select_module_command:
    type: rpc_command
    identity: legacy_service.server_identity
    function: select_module_partial
    state_attributes: []
    name: select_module

  collect_globals_command:
    type: rpc_command
    identity: legacy_service.server_identity
    function: servant_collect_globals_method
    state_attributes: ['current_key']
    name: collect_globals

  htest_module_list_d:
    type: call
    function: legacy_type.htest.htest_module_list_d

  service:
    type: live_list_service
    identity: legacy_service.server_identity
    function: servant_list_method
    dir: htest_module_list_d
    key_attribute: module_name
    commands:
      - module_command
      - collect_globals_command
